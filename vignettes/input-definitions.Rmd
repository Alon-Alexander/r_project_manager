---
title: "Defining Project Inputs: Different Formats for inputs.yaml"
author: "Alon Alexander"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{input-definitions}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = TRUE
)
library(pm)
```

## Introduction

The `inputs.yaml` file defines the inputs for your project in a portable way. This file can be written in several formats, from simple lists to detailed definitions with metadata. This vignette demonstrates all the supported formats.

## Format 1: Simple Array (IDs Only)

The simplest format is an array of input IDs:

```yaml
inputs:
  - feature_table
  - sample_metadata
  - raw_data
```

This format is useful when you just need to list the inputs without additional metadata.

### Read and Verify

```{r format1, echo = FALSE, results = 'hide'}
# Setup for examples
project_dir <- file.path(tempdir(), "input_formats_demo")
pm <- pm_create_project(project_dir)

# Create example files
file.create(file.path(project_dir, "feature_table.csv"))
file.create(file.path(project_dir, "sample_metadata.tsv"))
file.create(file.path(project_dir, "raw_data.csv"))
```

```{r format1-write, echo = FALSE, class.source = 'fold-hide'}
# Write format 1
inputs_yaml <- list(
  inputs = list("feature_table", "sample_metadata", "raw_data")
)
yaml::write_yaml(inputs_yaml, file.path(project_dir, "inputs.yaml"))

local_inputs <- list(
  paths = list(
    feature_table = "feature_table.csv",
    sample_metadata = "sample_metadata.tsv",
    raw_data = "raw_data.csv"
  )
)
yaml::write_yaml(local_inputs, file.path(project_dir, "inputs.local.yaml"))
```

```{r format1-read}
# Read and verify
pm <- pm_project(project_dir)
inputs <- pm$parse_inputs()
cat("Inputs defined:", paste(names(inputs), collapse = ", "), "\n")
```

## Format 2: Array with Metadata

You can add metadata to individual inputs in the array format:

```yaml
inputs:
  - feature_table
  - sample_metadata:
      description: "Sample metadata with treatment groups"
  - raw_data:
      description: "Raw experimental data"
      md5: "abc123def456"
      size: 1024
```

This allows you to document inputs and optionally include validation information (like MD5 checksums or file sizes).

### Read and Verify

```{r format2-write, echo = FALSE, class.source = 'fold-hide'}
# Write format 2
inputs_yaml <- list(
  inputs = list(
    "feature_table",
    list(
      sample_metadata = list(
        description = "Sample metadata with treatment groups"
      )
    ),
    list(
      raw_data = list(
        description = "Raw experimental data",
        md5 = "abc123def456",
        size = 1024
      )
    )
  )
)
yaml::write_yaml(inputs_yaml, file.path(project_dir, "inputs.yaml"))
```

```{r format2-read}
# Read and verify
pm <- pm_project(project_dir)
inputs <- pm$parse_inputs()
cat("Inputs defined:", paste(names(inputs), collapse = ", "), "\n")
```

## Format 3: Object Format with Metadata

The object format also supports metadata for each input:

```yaml
inputs:
  feature_table:
    description: "OTU table with feature counts"
  sample_metadata:
    description: "Sample metadata with treatment groups"
    md5: "def456ghi789"
    size: 1024
  raw_data:
    description: "Raw experimental measurements"
    size: 2048
```

This format is often preferred when you have multiple inputs with metadata, as it's more readable.

### Read and Verify

```{r format4-write, echo = FALSE, class.source = 'fold-hide'}
# Write format 3
inputs_yaml <- list(
  inputs = list(
    feature_table = list(
      description = "OTU table with feature counts"
    ),
    sample_metadata = list(
      description = "Sample metadata with treatment groups",
      md5 = "def456ghi789"
    ),
    raw_data = list(
      description = "Raw experimental measurements",
      size = 2048
    )
  )
)
yaml::write_yaml(inputs_yaml, file.path(project_dir, "inputs.yaml"))
```

```{r format4-read}
# Read and verify
pm <- pm_project(project_dir)
inputs <- pm$parse_inputs()
cat("Inputs defined:", paste(names(inputs), collapse = ", "), "\n")
```

## Mixed Formats

You can also mix simple IDs with detailed definitions in array format:

```yaml
inputs:
  - simple_input
  - detailed_input:
      description: "This input has metadata"
      md5: "1234567890abcdef"
  - another_simple_input
```

### Read and Verify

```{r format-mixed-write, echo = FALSE, class.source = 'fold-hide'}
# Write mixed format
inputs_yaml <- list(
  inputs = list(
    "simple_input",
    list(
      detailed_input = list(
        description = "This input has metadata",
        md5 = "1234567890abcdef"
      )
    ),
    "another_simple_input"
  )
)
yaml::write_yaml(inputs_yaml, file.path(project_dir, "inputs.yaml"))

# Update local inputs
local_inputs <- list(
  paths = list(
    simple_input = "simple_input.csv",
    detailed_input = "detailed_input.csv",
    another_simple_input = "another_simple_input.csv"
  )
)
invisible(file.create(file.path(project_dir, "simple_input.csv")))
invisible(file.create(file.path(project_dir, "detailed_input.csv")))
invisible(file.create(file.path(project_dir, "another_simple_input.csv")))
yaml::write_yaml(local_inputs, file.path(project_dir, "inputs.local.yaml"))
```

```{r format-mixed-read}
# Read and verify
pm <- pm_project(project_dir)
inputs <- pm$parse_inputs()
cat("Inputs defined:", paste(names(inputs), collapse = ", "), "\n")
```

## Metadata Fields

The following metadata fields are supported (all optional):

- **`description`**: Human-readable description of the input
- **`md5`**: MD5 checksum for validation (future feature)
- **`size`**: File size in bytes (future feature)

**Note**: MD5 and size validation are planned for future versions. Currently, these fields are stored but not validated.

## Choosing a Format

- **Use Format 1 (Simple Array)** when you just need to list inputs quickly
- **Use Format 2 (Array with Metadata)** when you have a mix of simple and detailed inputs
- **Use Format 3 (Object with Metadata)** when all inputs have metadata and you want maximum readability

All formats are equivalent in functionality - choose based on your preference and readability needs.

## Summary

The `inputs.yaml` file is flexible and supports multiple formats:

1. **Simple array**: Just list input IDs
2. **Array with metadata**: Add descriptions and validation info to specific inputs
4. **Object with metadata**: Combine object format with detailed metadata
5. **Mixed**: Combine simple and detailed definitions

All formats work with the same `parse_inputs()` method, so you can choose the format that best fits your project's needs.

For more information on using inputs in your workflow, see the [Getting Started](getting-started.html) vignette.
